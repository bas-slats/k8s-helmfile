# Cloudflared - External Secret for tunnel credentials
---
# Ensure cloudflared namespace exists
apiVersion: v1
kind: Namespace
metadata:
  name: cloudflared
---
# ExternalSecret to sync Cloudflare tunnel token from Vault
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cloudflare-tunnel-credentials
  namespace: cloudflared
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  target:
    name: cloudflare-tunnel-credentials
    creationPolicy: Owner
  data:
    # Cloudflare tunnel token
    # Store in Vault at: secret/data/cloudflare/tunnel
    # with key: token
    - secretKey: token
      remoteRef:
        key: secret/data/cloudflare/tunnel
        property: token
---
# Note: To create the tunnel token in Vault:
# 1. Create a tunnel in the Cloudflare dashboard
# 2. Copy the tunnel token
# 3. Store it in Vault:
#    vault kv put secret/cloudflare/tunnel token="YOUR_TUNNEL_TOKEN"
