# ArgoCD GitOps configuration

# Global settings
global:
  domain: argocd.slats.dev

# Server configuration
server:
  replicas: 1
  resources:
    requests:
      cpu: 25m
      memory: 64Mi
    limits:
      memory: 256Mi
  # Insecure mode - terminate TLS at ingress/tunnel
  extraArgs:
    - --insecure

# Repository server
repoServer:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      memory: 2Gi
  # Helmfile plugin sidecar
  extraContainers:
    - name: helmfile
      image: ghcr.io/helmfile/helmfile:v0.169.2
      command: ["/var/run/argocd/argocd-cmp-server"]
      securityContext:
        runAsNonRoot: true
        runAsUser: 999
      volumeMounts:
        - name: var-files
          mountPath: /var/run/argocd
        - name: plugins
          mountPath: /home/argocd/cmp-server/plugins
        - name: cmp-tmp
          mountPath: /tmp
        - name: helmfile-plugin
          mountPath: /home/argocd/cmp-server/config/plugin.yaml
          subPath: plugin.yaml
  volumes:
    - name: cmp-tmp
      emptyDir: {}
    - name: helmfile-plugin
      configMap:
        name: argocd-helmfile-plugin

# Application controller
controller:
  replicas: 1
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      memory: 512Mi

# Redis
redis:
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      memory: 128Mi

# Notifications controller
notifications:
  enabled: true
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      memory: 128Mi

# Application Set controller
applicationSet:
  enabled: true
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      memory: 128Mi

# Dex (OIDC) - disable if not using SSO
dex:
  enabled: false

# Configs
configs:
  params:
    # Application sync options
    application.instanceLabelKey: argocd.argoproj.io/instance
  cm:
    # Enable exec access for debugging
    exec.enabled: "true"
    # Admin password - change this!
    admin.enabled: "true"
    # Helm repositories for chart dependencies
    helm.repositories: |
      - name: bitnami
        url: https://charts.bitnami.com/bitnami
